generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------------------
// TABELA USUARIO
// ----------------------------
model usuario {
  id              Int      @id @default(autoincrement())
  cpf             String   @unique
  data_nascimento DateTime
  nome            String
  sobrenome       String
  email           String   @unique
  senha           String
  ativo           Boolean  @default(true)

  endereco endereco?
  contato  contato[]
  medico   medico?
  paciente paciente?
  perfis   perfil_usuario[]
}

// ----------------------------
// ENDEREÇO
// ----------------------------
model endereco {
  idendereco  Int     @id @default(autoincrement())
  usuario_id  Int     @unique
  logradouro  String
  numero      String
  complemento String?
  bairro      String
  cidade      String
  estado      String
  cep         String

  usuario usuario @relation(fields: [usuario_id], references: [id])
}

// ----------------------------
// CONTATO
// ----------------------------
model contato {
  id           Int     @id @default(autoincrement())
  usuario_id   Int
  tipo_contato String
  valor        String
  principal    Boolean @default(false)

  usuario usuario @relation(fields: [usuario_id], references: [id])
}

// ----------------------------
// PERFIL
// ----------------------------
model perfil {
  id       Int              @id @default(autoincrement())
  nome     String
  usuarios perfil_usuario[]
}

model perfil_usuario {
  id         Int @id @default(autoincrement())
  perfil_id  Int
  usuario_id Int

  perfil  perfil  @relation(fields: [perfil_id], references: [id])
  usuario usuario @relation(fields: [usuario_id], references: [id])
}

// ----------------------------
// PACIENTE
// ----------------------------
model paciente {
  id         Int     @id @default(autoincrement())
  usuario_id Int     @unique
  convenio   String?

  usuario  usuario    @relation(fields: [usuario_id], references: [id])
  consulta consulta[]
}

// ----------------------------
// MÉDICO
// ----------------------------
model medico {
  id         Int    @id @default(autoincrement())
  usuario_id Int    @unique
  crm        String

  usuario       usuario                @relation(fields: [usuario_id], references: [id])
  agendas       agenda[]
  especialidade especialidade_medico[]
  consulta      consulta[]
}

// ----------------------------
// ESPECIALIDADE
// ----------------------------
model especialidade {
  id        Int                    @id @default(autoincrement())
  nome      String
  descricao String
  medicos   especialidade_medico[]
}

model especialidade_medico {
  id               Int @id @default(autoincrement())
  especialidade_id Int
  medico_id        Int

  especialidade especialidade @relation(fields: [especialidade_id], references: [id])
  medico        medico        @relation(fields: [medico_id], references: [id])
}

// ----------------------------
// AGENDA
// ----------------------------
model agenda {
  id              Int      @id @default(autoincrement())
  medico_id       Int
  data            DateTime
  hora            String
  disponibilidade Boolean  @default(true)

  medico   medico     @relation(fields: [medico_id], references: [id])
  consulta consulta[]
}

// ----------------------------
// CONSULTA
// ----------------------------
model consulta {
  id                  Int     @id @default(autoincrement())
  paciente_id         Int
  medico_id           Int
  agenda_id           Int
  status              String  @default("agendada")
  motivo_cancelamento String?
  presenca            Boolean @default(false)

  paciente  paciente   @relation(fields: [paciente_id], references: [id])
  medico    medico     @relation(fields: [medico_id], references: [id])
  agenda    agenda     @relation(fields: [agenda_id], references: [id])
  avaliacao avaliacao?
}

// ----------------------------
// AVALIAÇÃO
// ----------------------------
model avaliacao {
  id             Int      @id @default(autoincrement())
  consulta_id    Int      @unique
  nota           Int
  comentario     String?
  data_avaliacao DateTime @default(now())

  consulta consulta @relation(fields: [consulta_id], references: [id])
}
